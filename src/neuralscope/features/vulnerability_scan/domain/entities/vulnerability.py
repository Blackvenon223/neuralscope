"""Vulnerability scanning domain entities."""

from __future__ import annotations

from dataclasses import dataclass, field
from enum import Enum


class VulnSeverity(str, Enum):
    LOW = "low"
    MEDIUM = "medium"
    HIGH = "high"
    CRITICAL = "critical"


class VulnSource(str, Enum):
    BANDIT = "bandit"
    SAFETY = "safety"
    SEMGREP = "semgrep"
    AI = "ai"


@dataclass(frozen=True)
class Vulnerability:
    id: str
    title: str
    severity: VulnSeverity
    source: VulnSource
    file_path: str = ""
    line: int = 0
    description: str = ""
    recommendation: str = ""
    cwe: str = ""


@dataclass
class VulnReport:
    project_path: str
    vulnerabilities: list[Vulnerability] = field(default_factory=list)
    summary: str = ""

    @property
    def total(self) -> int:
        return len(self.vulnerabilities)

    @property
    def critical_count(self) -> int:
        return sum(1 for v in self.vulnerabilities if v.severity == VulnSeverity.CRITICAL)

    @property
    def high_count(self) -> int:
        return sum(1 for v in self.vulnerabilities if v.severity == VulnSeverity.HIGH)

    @property
    def passed(self) -> bool:
        return self.critical_count == 0 and self.high_count == 0
